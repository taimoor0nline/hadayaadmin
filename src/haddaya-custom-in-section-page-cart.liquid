<section class="page-cart">
  <div class="content-pages">
    <div class="container container-v1">
      <div class="row">
        <div class="col-md-6" style="margin-top: -80px;">
          <div class="card">
            <div class="card-body">
              <div id="divLeft">
                {% if cart.item_count > 0 %}
                  <div class="row">
                    <div class="col-md-12 mx-0">
                      <form id="msform">
                        <!-- progressbar -->
                        <ul id="progressbar">
                          <li class="active" id="customize"><strong>Customize</strong></li>
                          <li id="personal"><strong>Delivery Details</strong></li>
                        </ul>
                        <!-- fieldsets -->
                        <fieldset>
                          <div class="form-card">
                            <div class="row">
                              <div class="col-md-11">
                                <h4>Gift Card & Message</h4>
                              </div>
                            </div>

                            <div class="row">
                              <div class="col-md-6 text-center">
                                <div class="card-img-top" data-tab="product">
                                  <img
                                    class="card-image"
                                    src="https://placehold.co/600x400?text=Choose+Card"
                                    alt="Card Placeholder"
                                  >
                                  <div class="indicator-message">
                                    <i class="fas fa-check-circle text-success"></i>
                                  </div>
                                </div>
                              </div>
                              <div class="col-md-6 text-center">
                                <div class="message-card" data-tab="message">
                                  <img
                                    src="https://placehold.co/600x400?text=Your+Message"
                                    alt="Message Placeholder"
                                    class="msg-image"
                                  >
                                  <div class="indicator-product">
                                    <i class="fas fa-check-circle text-success"></i>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                          <input
                            type="button"
                            name="next"
                            class="next action-button"
                            value="Next Step"
                            id="customizeNextStep"
                          >
                        </fieldset>
                        <fieldset>
                          <div class="form-card">
                            <div class="form-group row">
                              <label class="col-sm-2 col-form-label">Recipient name *</label>
                              <div class="col-sm-10">
                                <input
                                  type="text"
                                  class="form-control"
                                  name="recipient_name"
                                  placeholder="Recipient name"
                                >
                              </div>
                            </div>
                            <div class="form-group row">
                              <label class="col-sm-2 col-form-label">Recipient phone *</label>
                              <div class="col-sm-10">
                                <div class="input-group">
                                  <div class="input-group-prepend">
                                    <!--
                                      <select class="custom-select" name="phone_code">
                                          <option value="968">Oman (+968)</option>
                                      </select>
                                    -->
                                  </div>
                                  <input
                                    type="text"
                                    class="form-control"
                                    name="recipient_phone"
                                    placeholder="Recipient phone"
                                  >
                                </div>
                              </div>
                            </div>
                            <div class="form-group row">
                              <div class="col-sm-2">Ask for address</div>
                              <div class="col-sm-10">
                                <div class="custom-control custom-checkbox">
                                  <input
                                    type="checkbox"
                                    class="custom-control-input"
                                    id="askAddress"
                                    name="ask_address"
                                  >
                                  <label class="custom-control-label" for="askAddress"
                                    >Ask the recipient for the address</label
                                  >
                                </div>
                              </div>
                            </div>
                            <div class="form-group row" id="addressInfo" style="display:none;">
                              <div class="col-sm-2"></div>
                              <div class="col-sm-10">
                                <div class="alert alert-warning" role="alert">
                                  We will collect the address from the recipient. Delivery time may be impacted if the
                                  recipient is unreachable.
                                </div>
                              </div>
                            </div>
                            <div class="form-group row" id="zone">
                              <label class="col-sm-2 col-form-label">Zone *</label>
                              <div class="col-sm-10">
                                <select name="zone" class="form-control">
                                  <option>Select your Zone</option>
                                  <option value="al-batinah-north">Al Batinah North</option>
                                  <option value="al-batinah-south">Al Batinah South</option>
                                  <option value="muscat-governorate">Muscat Governorate</option>
                                  <option value="al-dakhiliyah">Al Dakhiliyah</option>
                                  <option value="musandam">Musandam</option>
                                </select>
                              </div>
                            </div>
                            <div class="form-group row" id="area">
                              <label class="col-sm-2 col-form-label">Area *</label>
                              <div class="col-sm-10">
                                <select name="area" class="form-control">
                                  <option disabled selected>Select your Area</option>
                                </select>
                              </div>
                            </div>
                            <div class="form-group row" id="recipientAddress">
                              <label class="col-sm-2 col-form-label">Recipient Address *</label>
                              <div class="col-sm-10">
                                <input
                                  type="text"
                                  class="form-control"
                                  name="recipient_address"
                                  placeholder="Recipient Address"
                                >
                              </div>
                            </div>
                            <div class="form-group row">
                              <div class="col-sm-2">Identity Secret</div>
                              <div class="col-sm-10">
                                <div class="custom-control custom-checkbox">
                                  <input
                                    type="checkbox"
                                    class="custom-control-input"
                                    id="keepIdentitySecret"
                                    name="keep_identity_secret"
                                  >
                                  <label class="custom-control-label" for="keepIdentitySecret"
                                    >Keep my identity secret</label
                                  >
                                </div>
                              </div>
                            </div>
                            <div class="form-group row">
                              <label class="col-sm-2 col-form-label">Delivery time</label>
                              <div class="col-sm-10">
                                <div class="btn-group btn-group-toggle delivery-time-buttons" data-toggle="buttons">
                                  <label class="btn btn-outline-primary active delivery-button">
                                    <input type="radio" name="delivery_time" value="fastest" autocomplete="off"> Fastest
                                    Delivery
                                  </label>
                                  <label
                                    class="btn btn-outline-primary delivery-button"
                                    data-toggle="modal"
                                    data-target="#deliveryModal"
                                  >
                                    <input type="radio" name="delivery_time" value="anotherTime" autocomplete="off">
                                    Another time
                                  </label>
                                </div>
                              </div>
                            </div>
                          </div>

                          <input type="button" name="previous" class="previous action-button-previous" value="Previous">
                          <input
                            type="button"
                            name="next"
                            class="next action-button"
                            value="checkout"
                            id="deliveryNextStep"
                            onclick="saveDeliveryDetailsAndRedirect()"
                          >
                        </fieldset>
                      </form>
                    </div>
                  </div>
                {% else %}
                  <p>{{ 'cart.general.empty' | t }}</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="shopping-cart-section">
            <div class="card">
              <div class="row">
                <div class="col-md-8 cart">
                  <div class="col align-self-left text-right text-muted"><button>Packing</button></div>
                  <div class="col align-self-center text-right text-muted">Total {{ cart.item_count }} items</div>
                  <div class="cart-items">
                    {% for item in cart.items %}
                      <div class="row border-top border-bottom">
                        <div class="row main align-items-center">
                          <div class="col-12">
                            <div class="row text-muted">{{ item.product.title }}</div>
                          </div>
                          <div class="col-2">
                            <a href="{{ item.url }}">
                              <img
                                class="img-fluid"
                                src="{{ item | img_url: 'small' }}"
                                alt="{{ item.title | escape }}"
                              >
                            </a>
                          </div>
                          <div class="col-4">
                            <div class="row">{{ item.variant.title }}</div>
                            <div class="row">{{ item.price | money_without_trailing_zeros }}</div>
                          </div>
                          <div class="col quantity-wrapper">
                            <button class="quantity-btn" onclick="decreaseQuantity('{{ item.variant_id }}')">-</button>
                            <div class="js-qty">
                              <input
                                type="text"
                                class="js-qty__num"
                                value="{{ item.quantity }}"
                                min="1"
                                data-id="{{ item.variant_id }}"
                                aria-label="quantity"
                                pattern="[0-9]*"
                                name="updates[]"
                                id="updates_{{ item.variant_id }}"
                              >
                            </div>
                            <button class="quantity-btn" onclick="increaseQuantity('{{ item.variant_id }}')">+</button>
                          </div>
                          <div class="col">
                            <a class="remove" href="/cart/change?line={{ forloop.index }}&quantity=0">
                              <i class="fa fa-trash"></i>
                            </a>
                          </div>
                        </div>
                      </div>
                    {% endfor %}
                  </div>

                  <div class="back-to-shop">
                    <span class="message-wrapper message-content"></span>&nbsp;<span
                      class="message-wrapper url-content"
                    ></span>
                    <br>
                    <span class="delivery-wrapper deliveryDate"></span>&nbsp;<span
                      class="delivery-wrapper deliveryT"
                    ></span
                    ><br>
                    <hr>
                    <a href="/collections/all">&leftarrow;</a><span class="text-muted">Back to shop</span>
                  </div>
                </div>
                <div class="col-md-4 summary">
                  <div>
                    <h5><b>Summary</b></h5>
                  </div>
                  <hr>
                  <div class="row">
                    <div class="col" style="padding-left:0;">Subtotal</div>
                    <div class="col text-right">{{ cart.total_price | money_without_trailing_zeros }}</div>
                  </div>
                  <div class="row">
                    <div class="col" style="padding-left:0;">Total</div>
                    <div class="col text-right">{{ cart.total_price | money_without_trailing_zeros }}</div>
                  </div>
                  <button class="btn" id="checkoutButton" disabled>CHECKOUT</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Modal HTML -->
<div
  class="modal fade"
  id="productModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="productModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productModalLabel">Customize Your Order</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" id="productMessageTabs" role="tablist">
          <li class="nav-item">
            <a
              class="nav-link active"
              id="products-tab"
              data-toggle="tab"
              href="#products"
              role="tab"
              aria-controls="products"
              aria-selected="true"
              >Choose Card</a
            >
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              id="message-tab"
              data-toggle="tab"
              href="#message"
              role="tab"
              aria-controls="message"
              aria-selected="false"
              >Add Message</a
            >
          </li>
        </ul>
        <!-- Tab panes -->
        <div class="tab-content">
          <div class="tab-pane active" id="products" role="tabpanel" aria-labelledby="products-tab">
            <div class="container">
              {% assign products = collections.cards.products %}
              <div class="row">
                {% if products.size > 0 %}
                  <div class="swiper mySwiper">
                    <div class="swiper-wrapper">
                      {% for product in products %}
                        {% for variant in product.variants %}
                          <div class="swiper-slide">
                            <input
                              type="radio"
                              name="selectedProduct"
                              id="product-{{ variant.id }}"
                              value="{{ variant.id }}"
                            >
                            <label for="product-{{ variant.id }}">
                              <div class="product-card">
                                <img
                                  src="{{ product.featured_image | img_url: 'medium' }}"
                                  alt="{{ product.title }}"
                                  class="modal-image"
                                >
                                <p>{{ variant.price | money_without_trailing_zeros }}</p>
                              </div>
                            </label>
                          </div>
                        {% endfor %}
                      {% endfor %}
                    </div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                    <div class="swiper-pagination"></div>
                  </div>
                {% else %}
                  <p>No products found in this collection.</p>
                {% endif %}
              </div>
            </div>
          </div>
          <div class="tab-pane" id="message" role="tabpanel" aria-labelledby="message-tab">
            <div class="form-group">
              <label for="customMessage">Message</label>
              <textarea class="form-control" id="customMessage" rows="3" placeholder="Enter your message"></textarea>
            </div>
            <div class="form-group">
              <label for="customLink">Paste a link to a song or video</label>
              <input type="url" class="form-control" id="customLink" placeholder="Enter URL">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button
          type="button"
          class="btn btn-primary"
          id="saveAndContinue"
          style="background-color: #f90; border-color: #f90;"
        >
          Save and Continue
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delivery Time Modal -->
<div
  class="modal fade"
  id="deliveryModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="deliveryModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg" role="document">
    <!-- Make modal larger -->
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deliveryModalLabel">Another time</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container">
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label>Select a delivery date *</label>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                  <label
                    class="btn btn-outline-primary delivery-date active"
                    style="background-color: #f90; color: white; border: none;"
                  >
                    <input type="radio" name="delivery_date" value="today" autocomplete="off" checked> Today : 01 August
                  </label>
                  <label
                    class="btn btn-outline-primary delivery-date"
                    style="background-color: #f90; color: white; border: none; margin-left: 5px;"
                  >
                    <input type="radio" name="delivery_date" value="tomorrow" autocomplete="off"> Tomorrow : 02 August
                  </label>
                  <label
                    class="btn btn-outline-primary delivery-date"
                    style="background-color: #f90; color: white; border: none; margin-left: 5px;"
                  >
                    <input type="radio" name="delivery_date" value="pickDate" autocomplete="off"> Pick a date
                  </label>
                </div>
              </div>
              <div class="form-group" id="datePicker" style="display:none;">
                <label>Select a delivery date *</label>
                <input type="date" class="form-control" name="picked_date">
              </div>
              <div class="form-group">
                <label>Select a delivery time *</label>
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                  <label
                    class="btn btn-outline-primary delivery_time"
                    style="background-color: #f90; color: white; border: none;"
                  >
                    <input type="radio" name="delivery_time_modal" value="10am-1pm" autocomplete="off"> 10:00am - 1:00pm
                  </label>
                  <label
                    class="btn btn-outline-primary delivery_time"
                    style="background-color: #f90; color: white; border: none; margin-left: 5px;"
                  >
                    <input type="radio" name="delivery_time_modal" value="1pm-4pm" autocomplete="off"> 1:00pm - 4:00pm
                  </label>
                  <label
                    class="btn btn-outline-primary delivery_time"
                    style="background-color: #f90; color: white; border: none; margin-left: 5px;"
                  >
                    <input type="radio" name="delivery_time_modal" value="4pm-7pm" autocomplete="off"> 4:00pm - 7:00pm
                  </label>
                  <label
                    class="btn btn-outline-primary delivery_time"
                    style="background-color: #f90; color: white; border: none; margin-left: 5px;"
                  >
                    <input type="radio" name="delivery_time_modal" value="7pm-10pm" autocomplete="off"> 7:00pm - 10:00pm
                  </label>
                  <label
                    class="btn btn-outline-primary delivery_time"
                    style="background-color: #f90; color: white; border: none; margin-left: 5px;"
                  >
                    <input type="radio" name="delivery_time_modal" value="8pm-12am" autocomplete="off"> 8:00pm - 12:00am
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button
          type="button"
          class="btn btn-primary"
          id="confirmDeliveryTime"
          style="background-color: #f90; border-color: #f90;"
        >
          Confirm
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  var swiper = new Swiper(".mySwiper", {
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
    loop: true,
      slidesPerView: "2",
    spaceBetween: 20,
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
  });
</script>

{% stylesheet %}
    .delivery-button {
        background-color: #f90 !important;
        color: white;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 4px;
        border: 2px solid transparent;
    }

    .delivery-button:hover {
        background-color: #e08900 !important;
    }

    .delivery-button.active,
    .delivery-button:active {
        background-color: #876022 !important;
    }

      .delivery-date.active,
      .delivery-date:active {
        background-color: #876022 !important;
    }

        .delivery_time.active,
      .delivery_time:active {
        background-color: #876022 !important;
    }

      .custom-control-input:checked ~ .custom-control-label::before {
          background-color: #f90;
          border-color: #f90;
      }

      #keepIdentitySecret:checked{
          background-color: #f90;
          border-color: #f90;
      }

      .modal-image,
      .card-image,msg-image {
          width: 100%;
          height: 200px;
          object-fit: cover;
      }

      .indicator-message,
      .indicator-product {
          position: absolute;
          bottom: 5px;
          right: 5px;
          display: none;
      }

      .cart-item {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 15px;
          margin-bottom: 10px;
          background-color: #f9f9f9;
          border-radius: 10px;
      }

      .cart-item.even {
          background-color: #f1f1f1;
      }

      .cart-item-thumbnail img {
          max-width: 80px;
          border-radius: 10px;
      }

      .cart-item-details {
          flex-grow: 1;
          margin-left: 15px;
      }

      .cart-item-title {
          font-weight: bold;
          display: block;
      }

      .cart-item-price {
          color: #000;
          font-weight: bold;
      }

      .quantity-wrapper {
          display: flex;
          align-items: center;
          border: 1px solid rgba(0, 0, 0, 0.137);
          padding: 5px;
          border-radius: 4px;
          height: 40px;
      }

      .quantity-wrapper .quantity-btn {
          background: none;
          border: none;
          font-size: 1rem;
          padding: 5px;
          cursor: pointer;
      }

      .quantity-wrapper .quantity-btn:focus {
          outline: none;
      }

      .quantity-wrapper .js-qty {
          display: flex;
          align-items: center;
      }

      .quantity-wrapper .js-qty__num {
          width: 40px;
          text-align: center;
          border: none;
          outline: none;
      }

      .quantity-btn {
          border: none;
          background-color: #fff;
          padding: 5px 10px;
          cursor: pointer;
      }

      .quantity-btn:focus {
          outline: none;
      }

      .quantity-btn:hover {
          background-color: #f0f0f0;
      }

      .quantity-input {
          width: 50px;
          text-align: center;
          border: none;
          border-left: 1px solid #ced4da;
          border-right: 1px solid #ced4da;
      }

      .quantity-input:focus {
          outline: none;
      }

      .cart-item-remove a {
          color: #d9534f;
          font-size: 20px;
          cursor: pointer;
          text-decoration: none;
          margin-left: 10px;
      }

      .cart-item-remove a:hover {
          color: #c9302c;
      }

      .shopping-cart-section .title {
          margin-bottom: 5vh;
      }

      .shopping-cart-section .card {
          margin: auto;
          max-width: 950px;
          width: 90%;
          box-shadow: 0 6px 20px 0 rgba(0, 0, 0, 0.19);
          border-radius: 1rem;
          border: transparent;
      }

      .shopping-cart-section .cart {
          background-color: #fff;
          padding: 4vh 5vh;
          border-bottom-left-radius: 1rem;
          border-top-left-radius: 1rem;
      }

      .shopping-cart-section .summary {
          background-color: #ddd;
          border-top-right-radius: 1rem;
          border-bottom-right-radius: 1rem;
          padding: 4vh;
          color: rgb(65, 65, 65);
      }

      .shopping-cart-section .summary .col-2 {
          padding: 0;
      }

      .shopping-cart-section .summary .col-10 {
          padding: 0;
      }

      .shopping-cart-section .row {
          margin: 0;
      }

      .shopping-cart-section .title b {
          font-size: 1.5rem;
      }

      .shopping-cart-section .main {
          margin: 0;
          padding: 2vh 0;
          width: 100%;
      }

      .shopping-cart-section .col-2,
      .shopping-cart-section .col {
          padding: 0 1vh;
      }

      .shopping-cart-section .card a {
          padding: 0 1vh;
      }

      .shopping-cart-section .close {
          margin-left: auto;
          font-size: 0.7rem;
      }

      .shopping-cart-section img {
          width: 3.5rem;
      }

      .shopping-cart-section .back-to-shop {
          margin-top: 4.5rem;
      }

      .shopping-cart-section h5 {
          margin-top: 4vh;
      }

      .shopping-cart-section hr {
          margin-top: 1.25rem;
      }

      .shopping-cart-section form {
          padding: 2vh 0;
      }

      .shopping-cart-section select {
          border: 1px solid rgba(0, 0, 0, 0.137);
          padding: 1.5vh 1vh;
          margin-bottom: 4vh;
          outline: none;
          width: 100%;
          background-color: rgb(247, 247, 247);
      }

      .shopping-cart-section input {
          border: 1px solid rgba(0, 0, 0, 0.137);
          padding: 1vh;
          margin-left: 10px;
          outline: none;
          width: 100%;
          background-color: none;
      }

      .shopping-cart-section input:focus::-webkit-input-placeholder {
          color: transparent;
      }

      .shopping-cart-section .btn {
          background-color: #f90;
          border-color: #f90;
          color: white;
          width: 100%;
          font-size: 0.7rem;
          margin-top: 4vh;
          padding: 1vh;
          border-radius: 0;
      }

      .shopping-cart-section .btn:focus {
          box-shadow: none;
          outline: none;
          color: white;
          -webkit-box-shadow: none;
          -webkit-user-select: none;
          transition: none;
      }

      .shopping-cart-section .btn:hover {
          color: white;
      }

      .shopping-cart-section .card a {
          color: black;
      }

      .shopping-cart-section .card a:hover {
          color: black;
          text-decoration: none;
      }

      .shopping-cart-section #code {
          background-image: linear-gradient(to left, rgba(255, 255, 255, 0.253), rgba(255, 255, 255, 0.185)), url("https://img.icons8.com/small/16/000000/long-arrow-right.png");
          background-repeat: no-repeat;
          background-position-x: 95%;
          background-position-y: center;
      }

      .quantity-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          color: #000;
      }

      .quantity-btn:hover {
          background-color: #f0f0f0;
      }

      #grad1 {
          background-color: : #9C27B0;
          background-image: linear-gradient(120deg, #FF4081, #81D4FA);
      }

      /*form styles*/
      #msform {
          text-align: center;
          position: relative;
          margin-top: 20px;
      }

      #msform fieldset .form-card {
          background: white;
          border: 0 none;
          border-radius: 0px;
          box-shadow: 0 2px 2px 2px rgba(0, 0, 0, 0.2);
          padding: 20px 40px 30px 40px;
          box-sizing: border-box;
          width: 94%;
          margin: 0 3% 20px 3%;

          /*stacking fieldsets above each other*/
          position: relative;
      }

      #msform fieldset {
          background: white;
          border: 0 none;
          border-radius: 0.5rem;
          box-sizing: border-box;
          width: 100%;
          margin: 0;
          padding-bottom: 20px;

          /*stacking fieldsets above each other*/
          position: relative;
      }

      /*Hide all except first fieldset*/
      #msform fieldset:not(:first-of-type) {
          display: none;
      }

      #msform fieldset .form-card {
          text-align: left;
          color: #9E9E9E;
      }

      #msform input, #msform textarea {
          padding: 0px 8px 4px 8px;
          border: none;
          border-bottom: 1px solid #ccc;
          border-radius: 0px;
          margin-bottom: 25px;
          margin-top: 2px;
          width: 100%;
          box-sizing: border-box;
          font-family: montserrat;
          color: #2C3E50;
          font-size: 16px;
          letter-spacing: 1px;
      }

      #msform input:focus, #msform textarea:focus {
          -moz-box-shadow: none !important;
          -webkit-box-shadow: none !important;
          box-shadow: none !important;
          border: none;
          font-weight: bold;
          border-bottom: 2px solid #f90;
          outline-width: 0;
      }

      /*Blue Buttons*/
      #msform .action-button {
          width: 100px;
          background: #f90;
          font-weight: bold;
          color: white;
          border: 0 none;
          border-radius: 0px;
          cursor: pointer;
          padding: 10px 5px;
          margin: 10px 5px;
      }

      #msform .action-button:hover, #msform .action-button:focus {
          box-shadow: 0 0 0 2px white, 0 0 0 3px #f90;
      }

      /*Previous Buttons*/
      #msform .action-button-previous {
          width: 100px;
          background: #616161;
          font-weight: bold;
          color: white;
          border: 0 none;
          border-radius: 0px;
          cursor: pointer;
          padding: 10px 5px;
          margin: 10px 5px;
      }

      #msform .action-button-previous:hover, #msform .action-button-previous:focus {
          box-shadow: 0 0 0 2px white, 0 0 0 3px #616161;
      }

      /*Dropdown List Exp Date*/
      select.list-dt {
          border: none;
          outline: 0;
          border-bottom: 1px solid #ccc;
          padding: 2px 5px 3px 5px;
          margin: 2px;
      }

      select.list-dt:focus {
          border-bottom: 2px solid #f90;
      }

      /*The background card*/
      .card {
          z-index: 0;
          border: none;
          border-radius: 0.5rem;
          position: relative;
      }

      /*FieldSet headings*/
      .fs-title {
          font-size: 25px;
          color: #2C3E50;
          margin-bottom: 10px;
          font-weight: bold;
          text-align: left;
      }

      /*progressbar*/
      #progressbar {
          margin-bottom: 30px;
          overflow: hidden;
          color: lightgrey;
      }

      #progressbar .active {
          color: #f90;
      }

      #progressbar li {
          list-style-type: none;
          font-size: 12px;
          width: 50%;
          float: left;
          position: relative;
      }

      /*Icons in the ProgressBar*/
      #progressbar #customize:before {
          font-family: FontAwesome;
          content: "1";
      }

      #progressbar #personal:before {
          font-family: FontAwesome;
          content: "2";
      }

      /*ProgressBar before any progress*/
      #progressbar li:before {
          width: 50px;
          height: 50px;
          line-height: 45px;
          display: block;
          font-size: 18px;
          color: #ffffff;
          background: lightgray;
          border-radius: 50%;
          margin: 0 auto 10px auto;
          padding: 2px;
      }

      /*ProgressBar connectors*/
      #progressbar li:after {
          content: '';
          width: 100%;
          height: 2px;
          background: lightgray;
          position: absolute;
          left: 0;
          top: 25px;
          z-index: -1;
      }

      /*Color number of the step and the connector before it*/
      #progressbar li.active:before, #progressbar li.active:after {
          background: #f90;
      }

      /*Imaged Radio Buttons*/
      .radio-group {
          position: relative;
          margin-bottom: 25px;
      }

      .radio {
          display: inline-block;
          width: 204;
          height: 104;
          border-radius: 0;
          background: lightblue;
          box-shadow: 0 2px 2px 2px rgba(0, 0, 0, 0.2);
          box-sizing: border-box;
          cursor: pointer;
          margin: 8px 2px;
      }

      .radio:hover {
          box-shadow: 2px 2px 2px 2px rgba(0, 0, 0, 0.3);
      }

      .radio.selected {
          box-shadow: 1px 1px 2px 2px rgba(0, 0, 0, 0.1);
      }

      /*Fit image in bootstrap div*/
      .fit-image {
          width: 100%;
          object-fit: cover;
      }

      .msg-image,
      .modal-image,
      .card-image {
          width: 100%;
          height: auto;
      }

      .message-card, .card-img-top{
          border: 1px solid #e9ecef;
          padding: 1rem;
          text-align: center;
          cursor: pointer;
      }

      .message-card img {
          width: 100%;
          height: 200px;
          object-fit: cover;
      }
      .card-img-top img {
          width: 100%;
          height: 200px;
          object-fit: cover;
      }

      .delivery-time-buttons .btn {
          margin-right: 5px;
          background-color: #f90;
          color: white;
          border: none;
      }

    .swiper {
        width: 100%;
        height: 100%;
      }

    .my-swiper{
      padding: 0 36px;
    }

      .swiper-slide {
        text-align: center;
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .swiper-slide img {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .swiper {
        margin-left: auto;
        margin-right: auto;
      }


    .swiper-slide .product-card{
      display:flex;
      flex-direction: column;
      gap: 2px;
      height: 300px;
    }

   .swiper-slide .product-card img{
     height: 230px;
     width: 100%;
     object-fit: cover;
   }

  /* Hide the radio button */
  input[type="radio"] {
    display: none; /* Completely hide the radio button */
  }

  /* Default product card styling */
  .product-card {
    background-color: #fff; /* White background by default */
    border-radius: 10px; /* Rounded corners */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow */
    transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.3s ease; /* Smooth transitions */
    padding: 15px;
    text-align: center;
    cursor: pointer; /* Add pointer cursor for interactivity */
  }

  /* Hover effect for the product card */
  .product-card:hover {
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); /* Darker shadow */
    transform: translateY(-5px); /* Lift effect */
  }

  /* Apply orange background when the radio button is checked */
  input[type="radio"]:checked + label .product-card {
    background-color: orange; /* Orange background for the selected card */
    color: #fff; /* White text for better contrast */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); /* Enhance shadow for the selected card */
    transform: translateY(-5px); /* Keep the lifted effect */
  }

  /* Image styling */
  .product-card img {
    max-width: 100%; /* Make image responsive */
    border-radius: 8px; /* Rounded corners */
    margin-bottom: 10px; /* Space between image and text */
  }

  /* Price text styling */
  .product-card p {
    font-size: 1rem;
    font-weight: bold;
    color: #333; /* Default dark color for price */
    margin: 0;
    transition: color 0.3s ease; /* Smooth color transition */
  }

  /* Change price text color when the card is selected */
  input[type="radio"]:checked + label .product-card p {
    color: #fff; /* Change to white when the card is checked */
  }


    .swiper-pagination{
      position: relative;
    }
    /* Swiper pagination bullets */
  .swiper-pagination-bullet {
    background-color: #ccc; /* Default bullet color */
    width: 10px;
    height: 10px;
    border-radius: 50%; /* Circular bullets */
    opacity: 1; /* Make bullets fully visible */
    transition: background-color 0.3s ease; /* Smooth transition for hover */
  }

  /* Active pagination bullet */
  .swiper-pagination-bullet-active {
    background-color: orange !important; /* Active bullet color */
  }

  /* Swiper navigation buttons */
  .swiper-button-next, .swiper-button-prev {
    /* background-color: #fff; /* White background for buttons */ */
    /* border-radius: 50%; /* Circular buttons */ */
    /* box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */ */
    width: 16px;
    height: 16px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: orange; /* Button icon color */
    font-size: 20px; /* Size of the arrow icons */
    transition: background-color 0.3s ease, transform 0.3s ease; /* Smooth hover effect */
  }

  /* Hover effect for navigation buttons */
  .swiper-button-next:hover, .swiper-button-prev:hover {
    /* background-color: orange; /* Change background on hover */ */
    color: white; /* Change arrow color on hover */
    transform: scale(1.1); /* Slightly enlarge on hover */
  }

  /* Position the navigation buttons */
  .swiper-button-next {
    right: 10px; /* Adjust the position from the right */
  }

  .swiper-button-prev {
    left: 10px; /* Adjust the position from the left */
  }

  /* Additional styles for Swiper container to ensure buttons are visible */
  .swiper {
    padding-bottom: 20px; /* Add space at the bottom for pagination */
  }

  .swiper-wrapper{
    padding: 40px 24px;
  }
{% endstylesheet %}

{% javascript %}
$(document).ready(function () {
  const baseUrl = 'https://api.haddaya.com';
  loadZones();



  let selectedDate = new Date().toISOString().split('T')[0];
  loadDeliverySlots(selectedDate);

  $(document).on('change', 'input[name="delivery_time"][value="anotherTime"]', function () {
    $('#deliveryModal').modal('show');
    loadDeliverySlots(selectedDate);
  });

  $(document).on('change', 'input[name="delivery_date"]', function () {
    const deliveryDateValue = $(this).val();
    if (deliveryDateValue === 'today') {
      selectedDate = new Date().toISOString().split('T')[0];
    } else if (deliveryDateValue === 'tomorrow') {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      selectedDate = tomorrow.toISOString().split('T')[0];
    }
    loadDeliverySlots(selectedDate);
  });

  $(document).on('change', 'input[name="picked_date"]', function () {
    selectedDate = $(this).val();
    loadDeliverySlots(selectedDate);
  });

  function loadDeliverySlots(date) {
    $.ajax({
      url: `${baseUrl}/slotByDate/${date}`,
      method: 'GET',
      dataType: 'json',
      success: function (data) {
        const slotContainer = $('.btn-group-toggle.delivery_time');
        slotContainer.empty();

        const currentTime = new Date();
        const selectedDateObject = new Date(date);
        const isToday = selectedDateObject.toDateString() === currentTime.toDateString();

        data.data.forEach(slot => {
          const slotClosingTime = new Date(`${date}T${slot.slotClosingTime}`);
          const isDisabled = isToday && currentTime >= slotClosingTime;

          const slotOption = `
            <label class="btn btn-outline-primary delivery_time ${isDisabled ? 'disabled' : ''}" 
                   style="background-color: ${isDisabled ? '#ccc' : '#f90'}; color: white; border: none;">
              <input type="radio" name="delivery_time_modal" value="${slot.startTime} - ${slot.endTime}" 
                     autocomplete="off" ${isDisabled ? 'disabled' : ''}>
              ${slot.startTime} - ${slot.endTime}
            </label>
          `;
          slotContainer.append(slotOption);
        });
      },
      error: function (error) {
        console.error('Error fetching delivery slots:', error);
      }
    });
  }

  $('input[name="delivery_date"]').change(function () {
    if ($(this).val() === 'pickDate') {
      $('#datePicker').show();
    } else {
      $('#datePicker').hide();
    }
  });

  $('#confirmDeliveryTime').on('click', function () {
    $('#deliveryModal').modal('hide');
  });
});








   $(document).on('change', 'select[name="zone"]', function () {
    const selectedZoneId = $(this).val();
    $('select[name="area"]').html('<option disabled selected>Select your Area</option>');
    if (selectedZoneId) {
      loadAreas(selectedZoneId);
    }
  });


  $(document).on('click', '.card-img-top, .message-card', function () {
    const tab = $(this).data('tab');
    $('#productModal').modal('show');
    if (tab === 'message') $('#message-tab').tab('show');
    else if (tab === 'product') $('#products-tab').tab('show');
  });

  let selectedImageUrl, customMessageContent = '', customLinkContent = '';

  $(document).on('change', 'input[name="selectedProduct"]', function () {
    if (this.checked) selectedImageUrl = $(this).next('label').find('img.modal-image').attr('src');
  });

  $('input[name="selectedProduct"]').first().prop('checked', true).trigger('change');

  $(document).on('input', '#customMessage', function () { customMessageContent = $(this).val().trim(); });
  $(document).on('input', '#customLink', function () { customLinkContent = $(this).val().trim(); });

  function updateMessageAndLink() {
    $('.message-content').html(customMessageContent ? `<strong>Your Message: </strong>${customMessageContent}` : '');
    $('.url-content').html(customLinkContent ? `<strong>Your URL: </strong>${customLinkContent}` : '');
    $('.message-wrapper').toggle(!!customMessageContent || !!customLinkContent);
  }

  function updateButtonText() {
    const activeTab = $('.nav-tabs .nav-link.active').attr('id');
    $('#saveAndContinue').text(activeTab === 'products-tab' ? 'Save and Continue' : 'Save');
  }

  $('.nav-tabs .nav-link').on('shown.bs.tab', updateButtonText);
  updateButtonText();

  function checkFormCompletion() {
    const requiredFields = ['input[name="recipient_name"]', 'input[name="recipient_phone"]', 'select[name="zone"]', 'select[name="area"]'];
    const allFilled = requiredFields.every(selector => $(selector).val() && $(selector).val().trim() !== '');
    $('#checkoutButton').prop('disabled', !allFilled);
  }

  $(document).on('input change', 'input, select', checkFormCompletion);

  function removeQuantityButtons() { $('.qty_minus, .qty_plus').remove(); }
  removeQuantityButtons();
  const observer = new MutationObserver(removeQuantityButtons);
  observer.observe(document.body, { childList: true, subtree: true });



  function addToCart(variantId) {
    $.post('/cart/add.js', { id: variantId, quantity: 1 }, function () {
      $('#productModal').modal('hide');
    }).fail(function (error) {
      console.log('Error adding product to cart', error);
    });
  }

  function saveDeliveryDetailsAndRedirect() {
    const attributes = {
      'Zone Name': $('select[name="zone"] option:selected').text(),
      'Area Name': $('select[name="area"] option:selected').text(),
      'Delivery Slot ID': $('input[name="delivery_slot_id"]').val(),
      'Delivery Slot Name': $('input[name="delivery_slot_name"]').val(),
      'Recipient Phone': $('input[name="recipient_phone"]').val(),
      'Recipient Name': $('input[name="recipient_name"]').val(),
      'Recipient Address': $('input[name="recipient_address"]').val(),
      'Delivery Time': $('input[name="delivery_time"]:checked').val() === "anotherTime"
        ? `${$('input[name="picked_date"]').val()} ${$('input[name="delivery_time_modal"]:checked').val()}`
        : $('input[name="delivery_time"]:checked').val(),
      'Delivery Status': $('input[name="ask_address"]').is(':checked') ? 'Pending for Address Update' : 'Pending',
      'Message': customMessageContent,
      'Message URL': customLinkContent,
      'Keep Identity Secret': $('input[name="keep_identity_secret"]').is(':checked') ? 'Yes' : 'No'
    };

    if (!$('input[name="ask_address"]').is(':checked')) {
      attributes['Recipient Address'] = $('input[name="recipient_address"]').val();
      attributes['Zone Name'] = $('select[name="zone"]').val();
      attributes['Area Name'] = $('select[name="area"]').val();
    }

    $.post('/cart/update.js', { attributes: attributes }, function () {
      window.location.href = '/checkout';
    }).fail(function (error) {
      console.log('Error saving delivery details', error);
    });
  }

  function saveProductMessage() {
    const selectedProduct = $('input[name="selectedProduct"]:checked').val();
    const properties = {
      'Message': customMessageContent,
      'Link': customLinkContent
    };
    if (selectedProduct) addToCart(selectedProduct);

    $.post('/cart/update.js', { attributes: properties }, function () {
      $('#productModal').modal('hide');
    }).fail(function (error) {
      console.log('Error saving product message', error);
    });
  }

  $(document).on('click', '#saveAndContinue', function (e) {
    e.preventDefault();
    const activeTab = $('.nav-tabs .nav-link.active').attr('id');
    
    if (activeTab === 'products-tab') {
      // Move to the "Message" tab
      $('#message-tab').tab('show');
    } else if (activeTab === 'message-tab') {
      // If already on the "Message" tab, close the modal
      $('#productModal').modal('hide');
    }
    
    if (selectedImageUrl) $('.card-image').attr('src', selectedImageUrl);
    updateMessageAndLink();
  });

  $(document).on('click', '#customizeNextStep', function () {
    const currentFieldset = $("#msform fieldset:visible");
    const nextFieldset = currentFieldset.next();

    $("#progressbar li").eq($("fieldset").index(nextFieldset)).addClass("active");

    currentFieldset.animate({ opacity: 0 }, {
      step: function (now) {
        currentFieldset.css({ display: 'none', position: 'relative' });
        nextFieldset.css({ opacity: 1 - now }).show();
      },
      duration: 600
    });
  });

  $(document).on('click', '.previous', function () {
    const currentFieldset = $("#msform fieldset:visible");
    const prevFieldset = currentFieldset.prev();

    $("#progressbar li").eq($("fieldset").index(currentFieldset)).removeClass("active");

    currentFieldset.animate({ opacity: 0 }, {
      step: function (now) {
        currentFieldset.css({ display: 'none', position: 'relative' });
        prevFieldset.css({ opacity: 1 - now }).show();
      },
      duration: 600
    });
  });

  $(document).on('click', '#deliveryNextStep', saveDeliveryDetailsAndRedirect);

  function loadZones() {
    $.ajax({
      url: `${baseUrl}/zones/list`,
      method: 'GET',
      dataType: 'json',
      success: function (data) {
        let zoneSelect = $('select[name="zone"]');
        zoneSelect.html('<option disabled selected>Select your Zone</option>');
        data.data.forEach(zone => {
          zoneSelect.append(`<option value="${zone.id}">${zone.name}</option>`);
        });
      },
      error: function (error) {
        console.error('Error fetching zones:', error);
      }
    });
  }

  // Function to load areas based on selected zone
  function loadAreas(zoneId) {
    $.ajax({
      url: `${baseUrl}/areas/list?zoneId=${zoneId}`,
      method: 'GET',
      dataType: 'json',
      success: function (data) {
        let areaSelect = $('select[name="area"]');
        areaSelect.html('<option disabled selected>Select your Area</option>');
        data.data.forEach(area => {
          areaSelect.append(`<option value="${area.id}">${area.name}</option>`);
        });
      },
      error: function (error) {
        console.error('Error fetching areas:', error);
      }
    });
  }

});
{% endjavascript %}
